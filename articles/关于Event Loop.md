---
title: 事件循环
category: JavaScript
date: 2022-3-28
---

#### 关于Event Loop

##### 1.为什么JavaScript是单线程？

总所周知，JavaScript语音的一个特点就是单线程，即任何时刻都只能做一件事，那么，为什么JavaScript不能是多线程呢？

我们知道，作为浏览器的脚本语言，JavaScript的主要用途是与用户互动，然后操作DOM，这就决定了它只能是单线程，如果是多线程的话，会带来很多麻烦，假设JavaScript是多线程，那如果用户同时执行了一个删除DOM和修改DOM的操作，这时浏览器应该以哪个线程为准呢？

所以为了避免这个问题，JavaScript采用了单线程。

##### 2.任务队列

单线程就意味着所有任务都需要排队，前一个任务完成才能执行后一个任务，如果前一个任务耗时很长，那么后面的任务那不就得一直等着？

这时候，JavaScript将任务分成了两种：同步任务和异步任务。同步任务：也就是在主线程上排队执行的任务；异步任务：不进入主线程，在得到结果后，进入任务队列的任务。

- 所有同步任务在主线程上执行，形成一个执行栈。
- 主线程之外，还存在一个任务队列，只要异步任务有了结果，就会将结果（一般就是回调函数）放入任务队列中
- 一旦执行栈中的所有同步任务执行完毕后，系统就会读取任务队列，并将其依次放入执行栈，开始执行。
- 主线程不断重复上面的三步

##### 3.事件和回调函数

IO设备完成一项任务，就会在任务队列中添加一个事件，表示相关的异步任务可以进行执行栈执行了，除了IO设备的事件之外，还包括一些用户产生的事件，比如鼠标点击事件，页面滚动事件，所触发的回调函数，这些事件触发时，都会将回调函数添加进入任务队列。

##### 4.宏任务和微任务

在异步任务中，根据任务的优先级又分为宏任务和微任务，宏任务存在任务队列中，微任务存在微任务队列中，常见的宏任务有`setTimeout`，触发事件的回调函数

##### 5.Event Loop

主线程从任务队列中读取事件，并执行，执行完之后，检查微任务队列，将所有的任务依次执行，然后再读取任务队列中的下一个事件，并循环以上过程，这就是事件循环机制。